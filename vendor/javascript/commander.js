import t from"events";import n from"child_process";import e from"keypress";import o from"fs";import i from"path";import r from"tty";import s from"process";var p="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};var m=s;var u=t.EventEmitter,l=n.spawn,h=e,c=o,f=c.existsSync,d=i,g=r,y=d.dirname,v=d.basename;a=a=new Command;a.Command=Command;a.Option=Option;function Option(t,n){(this||p).flags=t;(this||p).required=~t.indexOf("<");(this||p).optional=~t.indexOf("[");(this||p).bool=!~t.indexOf("-no-");t=t.split(/[ ,|]+/);t.length>1&&!/^[[<]/.test(t[1])&&((this||p).short=t.shift());(this||p).long=t.shift();(this||p).description=n||""}Option.prototype.name=function(){return(this||p).long.replace("--","").replace("no-","")};Option.prototype.is=function(t){return t==(this||p).short||t==(this||p).long};function Command(t){(this||p).commands=[];(this||p).options=[];(this||p)._execs=[];(this||p)._args=[];(this||p)._name=t}Command.prototype.__proto__=u.prototype;Command.prototype.command=function(t,n){var e=t.split(/ +/);var o=new Command(e.shift());n&&o.description(n);n&&((this||p).executables=true);n&&((this||p)._execs[o._name]=true);(this||p).commands.push(o);o.parseExpectedArgs(e);o.parent=this||p;return n?this||p:o};Command.prototype.addImplicitHelpCommand=function(){this.command("help [cmd]","display help for [cmd]")};Command.prototype.parseExpectedArgs=function(t){if(t.length){var n=this||p;t.forEach((function(t){switch(t[0]){case"<":n._args.push({required:true,name:t.slice(1,-1)});break;case"[":n._args.push({required:false,name:t.slice(1,-1)});break}}));return this||p}};Command.prototype.action=function(t){var n=this||p;(this||p).parent.on((this||p)._name,(function(e,o){o=o||[];var i=n.parseOptions(o);outputHelpIfNecessary(n,i.unknown);i.unknown.length>0&&n.unknownOption(i.unknown[0]);i.args.length&&(e=i.args.concat(e));n._args.forEach((function(t,o){t.required&&null==e[o]&&n.missingArgument(t.name)}));n._args.length?e[n._args.length]=n:e.push(n);t.apply(this||p,e)}));return this||p};Command.prototype.option=function(t,n,e,o){var i=this||p,r=new Option(t,n),s=r.name(),a=camelcase(s);"function"!=typeof e&&(o=e,e=null);if(false==r.bool||r.optional||r.required){false==r.bool&&(o=true);void 0!==o&&(i[a]=o)}(this||p).options.push(r);this.on(s,(function(t){null!=t&&e&&(t=e(t));"boolean"==typeof i[a]||"undefined"==typeof i[a]?i[a]=null==t?!!r.bool&&(o||true):t:null!==t&&(i[a]=t)}));return this||p};Command.prototype.parse=function(t){(this||p).executables&&this.addImplicitHelpCommand();(this||p).rawArgs=t;(this||p)._name=(this||p)._name||v(t[1]);var n=this.parseOptions(this.normalize(t.slice(2)));var e=(this||p).args=n.args;var o=this.parseArgs((this||p).args,n.unknown);var i=o.args[0];return(this||p)._execs[i]?this.executeSubCommand(t,e,n.unknown):o};Command.prototype.executeSubCommand=function(t,n,e){n=n.concat(e);n.length||this.help();"help"==n[0]&&1==n.length&&this.help();if("help"==n[0]){n[0]=n[1];n[1]="--help"}var o=y(t[1]);var i=v(t[1])+"-"+n[0];var r=d.join(o,i);n=n.slice(1);var s=l(r,n,{stdio:"inherit",customFds:[0,1,2]});s.on("error",(function(t){"ENOENT"==t.code?console.error("\n  %s(1) does not exist, try --help\n",i):"EACCES"==t.code&&console.error("\n  %s(1) not executable. try chmod or run with root\n",i)}));(this||p).runningCommand=s};Command.prototype.normalize=function(t){var n=[],e,o;for(var i=0,r=t.length;i<r;++i){e=t[i];e.length>1&&"-"==e[0]&&"-"!=e[1]?e.slice(1).split("").forEach((function(t){n.push("-"+t)})):/^--/.test(e)&&~(o=e.indexOf("="))?n.push(e.slice(0,o),e.slice(o+1)):n.push(e)}return n};Command.prototype.parseArgs=function(t,n){var e=(this||p).commands,o=e.length,i;if(t.length){i=t[0];this.listeners(i).length?this.emit(t.shift(),t,n):this.emit("*",t)}else{outputHelpIfNecessary(this||p,n);n.length>0&&this.unknownOption(n[0])}return this||p};Command.prototype.optionFor=function(t){for(var n=0,e=(this||p).options.length;n<e;++n)if((this||p).options[n].is(t))return(this||p).options[n]};Command.prototype.parseOptions=function(t){var n=[],e=t.length,o,i,r;var s=[];for(var p=0;p<e;++p){r=t[p];if("--"!=r)if(o)n.push(r);else{i=this.optionFor(r);if(i)if(i.required){r=t[++p];if(null==r)return this.optionMissingArgument(i);if("-"==r[0]&&"-"!=r)return this.optionMissingArgument(i,r);this.emit(i.name(),r)}else if(i.optional){r=t[p+1];null==r||"-"==r[0]&&"-"!=r?r=null:++p;this.emit(i.name(),r)}else this.emit(i.name());else if(r.length>1&&"-"==r[0]){s.push(r);t[p+1]&&"-"!=t[p+1][0]&&s.push(t[++p])}else n.push(r)}else o=true}return{args:n,unknown:s}};Command.prototype.missingArgument=function(t){console.error();console.error("  error: missing required argument `%s'",t);console.error();m.exit(1)};Command.prototype.optionMissingArgument=function(t,n){console.error();n?console.error("  error: option `%s' argument missing, got `%s'",t.flags,n):console.error("  error: option `%s' argument missing",t.flags);console.error();m.exit(1)};Command.prototype.unknownOption=function(t){console.error();console.error("  error: unknown option `%s'",t);console.error();m.exit(1)};Command.prototype.version=function(t,n){if(0==arguments.length)return(this||p)._version;(this||p)._version=t;n=n||"-V, --version";this.option(n,"output the version number");this.on("version",(function(){console.log(t);m.exit(0)}));return this||p};Command.prototype.description=function(t){if(0==arguments.length)return(this||p)._description;(this||p)._description=t;return this||p};Command.prototype.usage=function(t){var n=(this||p)._args.map((function(t){return t.required?"<"+t.name+">":"["+t.name+"]"}));var e="[options"+((this||p).commands.length?"] [command":"")+"]"+((this||p)._args.length?" "+n:"");if(0==arguments.length)return(this||p)._usage||e;(this||p)._usage=t;return this||p};Command.prototype.largestOptionLength=function(){return(this||p).options.reduce((function(t,n){return Math.max(t,n.flags.length)}),0)};Command.prototype.optionHelp=function(){var t=this.largestOptionLength();return[pad("-h, --help",t)+"  "+"output usage information"].concat((this||p).options.map((function(n){return pad(n.flags,t)+"  "+n.description}))).join("\n")};Command.prototype.commandHelp=function(){return(this||p).commands.length?["","  Commands:","",(this||p).commands.map((function(t){var n=t._args.map((function(t){return t.required?"<"+t.name+">":"["+t.name+"]"})).join(" ");return pad(t._name+(t.options.length?" [options]":"")+" "+n,22)+(t.description()?" "+t.description():"")})).join("\n").replace(/^/gm,"    "),""].join("\n"):""};Command.prototype.helpInformation=function(){return["","  Usage: "+(this||p)._name+" "+this.usage(),""+this.commandHelp(),"  Options:","",""+this.optionHelp().replace(/^/gm,"    "),"",""].join("\n")};Command.prototype.promptForNumber=function(t,n){var e=this||p;this.promptSingleLine(t,(function parseNumber(o){o=Number(o);if(isNaN(o))return e.promptSingleLine(t+"(must be a number) ",parseNumber);n(o)}))};Command.prototype.promptForDate=function(t,n){var e=this||p;this.promptSingleLine(t,(function parseDate(o){o=new Date(o);if(isNaN(o.getTime()))return e.promptSingleLine(t+"(must be a date) ",parseDate);n(o)}))};Command.prototype.promptForRegexp=function(t,n,e){var o=this||p;this.promptSingleLine(t,(function parseRegexp(i){if(!n.test(i))return o.promptSingleLine(t+"(regular expression mismatch) ",parseRegexp);e(i)}))};Command.prototype.promptSingleLine=function(t,n){if(void 0!==arguments[1].global&&void 0!==arguments[1].multiline)return this.promptForRegexp(t,arguments[1],arguments[2]);if("function"==typeof arguments[2])return this["promptFor"+(n.name||n)](t,arguments[2]);m.stdout.write(t);m.stdin.setEncoding("utf8");m.stdin.once("data",(function(t){n(t.trim())})).resume()};Command.prototype.promptMultiLine=function(t,n){var e=[];console.log(t);m.stdin.setEncoding("utf8");m.stdin.on("data",(function(t){if("\n"==t||"\r\n"==t){m.stdin.removeAllListeners("data");n(e.join("\n"))}else e.push(t.trimRight())})).resume()};Command.prototype.prompt=function(t,n){var e=this||p;if("string"==typeof t){if(/ $/.test(t))return(this||p).promptSingleLine.apply(this||p,arguments);this.promptMultiLine(t,n)}else{var o=Object.keys(t),i={};function next(){var r=o.shift(),s=t[r];if(!r)return n(i);e.prompt(s,(function(t){i[r]=t;next()}))}next()}};Command.prototype.password=function(t,n,e){var o=this||p,i="";if("function"==typeof n){e=n;n=""}h(m.stdin);function setRawMode(t){m.stdin.setRawMode?m.stdin.setRawMode(t):g.setRawMode(t)}setRawMode(true);m.stdout.write(t);m.stdin.on("keypress",(function(r,s){if(s&&"enter"==s.name){console.log();m.stdin.pause();m.stdin.removeAllListeners("keypress");setRawMode(false);if(!i.trim().length)return o.password(t,n,e);e(i)}else{if(s&&s.ctrl&&"c"==s.name){console.log("%s",i);m.exit()}m.stdout.write(n);i+=r}})).resume()};Command.prototype.confirm=function(t,n,e){var o=this||p;this.prompt(t,(function(i){if(!i.trim()){e||(t+="(yes or no) ");return o.confirm(t,n,true)}n(parseBool(i))}))};Command.prototype.choose=function(t,n,e){var o=this||p,i="number"==typeof n;if(!i){e=n;n=null}t.forEach((function(t,e){i&&e==n?console.log("* %d) %s",e+1,t):console.log("  %d) %s",e+1,t)}));function again(){o.prompt("  : ",(function(o){o=parseInt(o,10)-1;i&&isNaN(o)&&(o=n);null==t[o]?again():e(o,t[o])}))}again()};Command.prototype.outputHelp=function(){m.stdout.write(this.helpInformation());this.emit("--help")};Command.prototype.help=function(){this.outputHelp();m.exit()};function camelcase(t){return t.split("-").reduce((function(t,n){return t+n[0].toUpperCase()+n.slice(1)}))}function parseBool(t){return/^y|yes|ok|true$/i.test(t)}function pad(t,n){var e=Math.max(0,n-t.length);return t+Array(e+1).join(" ")}function outputHelpIfNecessary(t,n){n=n||[];for(var e=0;e<n.length;e++)if("--help"==n[e]||"-h"==n[e]){t.outputHelp();m.exit(0)}}var C=a;const x=a.Command,w=a.Option;export default C;export{x as Command,w as Option};

